!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=6)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){t.exports=n(11)},function(t,e,n){var r=n(7),o=n(8),i=n(9),a=n(10);t.exports=function(t){return r(t)||o(t)||i(t)||a()},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){function n(t,e,n,r,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,o)}t.exports=function(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function s(t){n(a,o,i,s,u,"next",t)}function u(t){n(a,o,i,s,u,"throw",t)}s(void 0)}))}},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){n(13),t.exports=n(12)},function(t,e,n){var r=n(5);t.exports=function(t){if(Array.isArray(t))return r(t)},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){var r=n(5);t.exports=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){var r=function(t){"use strict";var e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new _(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return k()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=w(a,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=c(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),i}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function p(){}var d={};s(d,o,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(S([])));m&&m!==e&&n.call(m,o)&&(d=m);var y=p.prototype=f.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,s){var u=c(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function b(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(b,this),this.reset(!0)}function S(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return h.prototype=p,s(y,"constructor",p),s(p,"constructor",h),h.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},g(x.prototype),s(x.prototype,i,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(y),s(y,a,"Generator"),s(y,o,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=S,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;T(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:S(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}(t.exports);try{regeneratorRuntime=r}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var r=n(3),o=n.n(r),i=n(4),a=n.n(i),s=n(2),u=n.n(s),c=n(0),l=n.n(c),f=n(1),h=n.n(f),p=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3?arguments[3]:void 0;l()(this,t);for(var i=[],a=0;a<(r+2)*(n-1)+1;a+=1)o.random_num(0,1)<.35?i.push(0):i.push(o.random_int(1,n-1));this.config={size:e,timestamps:e,k:n,r:r,ruleString:i,random:o}}return h()(t,[{key:"generate",value:function(){var e=this;this.grid=[Array(this.config.size).fill(0).map((function(){return e.config.random.random_int(0,e.config.k-1)}))];for(var n=0;n<this.config.timestamps;n+=1){for(var r=[],o=0;o<this.config.size;o+=1){for(var i=[],a=o-this.config.r;a<=o+this.config.r;a+=1)i.push(a>=0&&a<this.config.size?this.grid[this.grid.length-1][a]:0);r.push(t.totalisticRule(i,this.config.k,this.config.ruleString))}this.grid.push(r)}}},{key:"getCell",value:function(t){return t<0||t>=this.config.size*this.config.size?null:this.grid[Math.floor(t/this.config.size)][t%this.config.size]}}],[{key:"totalisticRule",value:function(t,e,n){var r=t.length*(e-1)+1,o=t.reduce((function(t,e){return t+e}),0);return Number(n[r-1-o])}}]),t}(),d=function(){function t(e){l()(this,t);var n={hash:e};this.useA=!1;var r=function(t){var e=parseInt(t.substr(0,8,16)),n=parseInt(t.substr(8,8,16)),r=parseInt(t.substr(16,8,16)),o=parseInt(t.substr(24,8,16));return function(){var t=((e|=0)+(n|=0)|0)+(o|=0)|0;return o=o+1|0,e=n^n>>>9,n=(r|=0)+(r<<3)|0,r=(r=r<<21|r>>>11)+t|0,(t>>>0)/4294967296}};this.prngA=new r(n.hash.substr(2,32)),this.prngB=new r(n.hash.substr(34,32));for(var o=0;o<1e6;o+=2)this.prngA(),this.prngB()}return h()(t,[{key:"random_dec",value:function(){return this.useA=!this.useA,this.useA?this.prngA():this.prngB()}},{key:"random_num",value:function(t,e){return t+(e-t)*this.random_dec()}},{key:"random_int",value:function(t,e){return Math.floor(this.random_num(t,e+1))}},{key:"random_bool",value:function(t){return this.random_dec()<t}},{key:"random_choice",value:function(t){return t[this.random_int(0,t.length-1)]}}]),t}(),v=function(){function t(e,n,r){l()(this,t),this.context=n,this.automata=e,this.random=r,this.activeNoteIdx=null,this.palette=["#f44336","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722"];this.backgroundColor="#2B94E1"}return h()(t,[{key:"setDim",value:function(t,e){this.width=t,this.height=e}},{key:"getScaleParam",value:function(t,e){var n=Math.min(t,e),r=n/1e3;return{CELL_SIZE:1e3/this.automata.config.size,M:r,scale:t/e<=1?t:e,DIM:n}}},{key:"render",value:function(t,e){var n=this,r=this.getScaleParam(t,e),o=r.CELL_SIZE,i=r.M,a=(r.DIM,r.scale),s=.5*(t-a),u=.5*(e-a);this.context.clearRect(0,0,t,e),this.context.fillStyle="white",this.context.fillRect(0,0,t,e);var c=o/2.5;if(this.automata.grid.forEach((function(t,e){t.forEach((function(t,r){if(t>0){var a=r*o+c,l=e*o+c;n.context.fillStyle=n.palette[t],n.context.beginPath(),n.context.arc(s+a*i,u+l*i,c*i,0,2*Math.PI),n.context.fill()}}))})),null!==this.activeNoteIdx&&this.activeNoteIdx<this.automata.config.size*this.automata.config.size){var l=this.automata.config.size,f=Math.floor(this.activeNoteIdx/l),h=this.activeNoteIdx%l*o+c,p=f*o+c,d=this.automata.getCell(this.activeNoteIdx);d>0&&(this.context.fillStyle=this.palette[d],this.context.beginPath(),this.context.arc(s+h*i,u+p*i,c*i*1.5,0,2*Math.PI),this.context.fill())}}},{key:"setActiveNode",value:function(t){this.activeNoteIdx=t}}]),t}(),m=["A","B","C","D","E","F","G"],y=function(t,e){return t.map((function(n){var r=-1!==t.indexOf("C")?t.indexOf("C"):t.indexOf("C#"),o=t.indexOf(n)<r?e-1:e;return"".concat(n).concat(o)}))},g=[null].concat(o()(y(m,3)),o()(y(m,4))),x=["8n","4n","4n.","2n","2n","2n.","2n.","1n"],w=0,b=function(){function t(e,n){l()(this,t),this.automata=e,this.renderer=n,this.state={toneStarted:!1,playing:!1,rowIdx:0,colIdx:0},this.instruments={}}var e,n;return h()(t,[{key:"getSequence",value:function(){var t=this,e=Array(this.automata.config.size*this.automata.config.size).fill(0).map((function(e,n){return{idx:n,val:t.automata.getCell(n),note:g[t.automata.getCell(n)]}})),n=function(t,e){for(var n=[],r=0;r<t.length;r+=e){var o=t.slice(r,r+e);n.push(o)}return n}(e,8);e=[];var r=Tone.Time(0);n.map((function(t){for(var n=0,o=0;n<t.length&&o<t.length;){for(o=n+1;o<t.length&&t[n].note===t[o].note;)o+=1;var i=o-n;e.push({startIdx:t[n].idx,endIdx:t[o-1].idx,val:t[n].val,note:t[n].note,time:r.toBarsBeatsSixteenths(),duration:x[i-1]}),r=Tone.Time(r+Tone.Time(x[i-1])),n=o}}));var i=n.slice(0,4);r=Tone.Time(0);var a=[];i.map((function(t){t.map((function(t){var e=t.val;e>=1&&e<=5&&a.push({note:"C1",time:r.toBarsBeatsSixteenths(),duration:"8n"}),r=Tone.Time(r+Tone.Time("8n"))}))}));var s=n.slice(2,6);r=Tone.Time(0);var u=[];s.map((function(t){t.map((function(t){var e=t.val;e>=6&&e<=10&&u.push({time:r.toBarsBeatsSixteenths(),duration:"4n"}),r=Tone.Time(r+Tone.Time("8n"))}))}));var c=n.slice(4,8);r=Tone.Time(0);var l=[],f=[null].concat(o()(y(m,2)));return c.map((function(t){t.map((function(t,e){var n=t.val;n>=1&&n<=7&&l.push({note:f[n],time:r.toBarsBeatsSixteenths(),duration:"4n"}),r=Tone.Time(r+Tone.Time("4n"))}))})),{mainMelodySequence:e,drumSequence:a,snareSequence:u,bassSequence:l}}},{key:"prepareAudio",value:(n=a()(u.a.mark((function t(){var e,n,r,o,i,a,s,c,l,f,h=this;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Tone.Transport.bpm.value=120,this.state.toneStarted=!0,this.instruments.synth=new Tone.PolySynth({voice:Tone.Synth,maxPolyphony:20}).toDestination(),this.instruments.synth2=new Tone.Synth({oscillator:{volume:3,count:3,spread:40,type:"fatsawtooth"}}).toDestination(),e=this.getSequence(),n=e.mainMelodySequence,r=e.drumSequence,o=e.snareSequence,i=e.bassSequence,a=new Tone.PolySynth(Tone.Synth,{volume:1,oscillator:{partials:[1,2,1]},portamento:.05}).toDestination(),s=new Tone.FMSynth({harmonicity:1,modulationIndex:3.5,oscillator:{type:"custom",partials:[0,1,0,2]},envelope:{attack:.08,decay:.3,sustain:0},modulation:{type:"square"},modulationEnvelope:{attack:.1,decay:.2,sustain:.3,release:.01}}).toDestination(),new Tone.Part((function(t,e){e.startIdx,e.endIdx,e.val;var n=e.note,r=e.duration;a.triggerAttackRelease(n,r,t)}),n).start(0),c=new Tone.MembraneSynth({volume:6}).toDestination(),new Tone.Part((function(t,e){var n=e.note,r=e.duration;c.triggerAttackRelease(n,r,t)}),r).start(0).loop=!0,l=new Tone.Filter({frequency:8e3}).toDestination(),f=new Tone.NoiseSynth({volume:-5,envelope:{attack:.001,decay:.2,sustain:.02},filterEnvelope:{attack:.001,decay:.1,sustain:0}}).connect(l),new Tone.Part((function(t,e){e.note;var n=e.duration;f.triggerAttackRelease(n,t)}),o).start(0).loop=!0,new Tone.Part((function(t,e){var n=e.note,r=e.duration;s.triggerAttackRelease(n,r,t)}),i).start(0).loop=!0,new Tone.Loop((function(t){h.renderer.setActiveNode(w),(w+=1)>h.automata.config.size*h.automata.config.size&&h.stop()}),"8n").start(0),t.next=20,Tone.start();case 20:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"togglePlay",value:function(){"started"===Tone.Transport.state?this.stop():this.play()}},{key:"play",value:(e=a()(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return w=0,t.next=3,this.prepareAudio();case 3:Tone.Transport.start();case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"stop",value:function(){Tone.Transport.stop(),Tone.Transport.cancel()}}]),t}(),T={hash:"0x95c138f8b54949c12d05105cfc01960fc496813cbc3495b277aeed748549631"},_=new d(T.hash),S=new p(32,15,1,_);S.generate();var k,E,L,A,I,M=window,P=document,O=P.body.appendChild(P.createElement("canvas")),j=O.getContext("2d"),C=new v(S,j,_),F=new b(S,C),N=new dat.GUI({autoPlace:!0,width:300}),z=function t(){C.render(k,E),N.updateDisplay(),A=requestAnimationFrame(t)},B={resetAnimation:(I=a()(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:F.stop(),T={hash:"0x".concat((e=64,o()(Array(e)).map((function(){return Math.floor(16*Math.random()).toString(16)})).join("")))},_=new d(T.hash),(S=new p(32,15,1,_)).generate(),C=new v(S,j,_),F=new b(S,C),cancelAnimationFrame(A),z(),B.hash=T.hash,N.updateDisplay();case 12:case"end":return t.stop()}var e}),t)}))),function(){return I.apply(this,arguments)}),hash:T.hash};N.add(B,"resetAnimation").name("Randomize Hash"),N.show();var q=function(){k=M.innerWidth,E=M.innerHeight,L=M.devicePixelRatio,O.width=~~(k*L),O.height=~~(E*L),O.style.width="".concat(k,"px"),O.style.height="".concat(E,"px"),j.save(),j.scale(L,L),j.restore()};O.addEventListener("click",(function(){F.togglePlay()})),M.addEventListener("resize",q),q(),z()}]);
//# sourceMappingURL=app.bundle.js.map